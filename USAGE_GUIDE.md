# Руководство по использованию улучшенного бота

## 🚀 Быстрый старт

### Для пользователей

1. **Начало работы**: Отправьте `/start` боту
2. **Главное меню**: Используйте `/menu` для доступа ко всем функциям
3. **Профиль**: `/profile` - просмотр и редактирование ваших данных
4. **Помощь**: `/help` - справка по командам

### Для менеджеров

1. **Вход в систему**: Отправьте `/manager`
2. **Введите пароль**: Пароль из файла `.env` (по умолчанию: `manager123`)
3. **Панель управления**: Выберите нужное действие в меню

## 👤 Пользовательский интерфейс

### Основные функции:

**📋 Главное меню** (`/menu`)
- 👤 Мой профиль - просмотр данных регистрации
- ❓ Помощь - справка и полезная информация  
- ⚙️ Настройки - управление подпиской и аккаунтом

**👤 Профиль пользователя**
- Просмотр всех данных регистрации
- Статистика участия в клубе
- Возможность обновления информации

**⚙️ Настройки**
- 📧 Включение/отключение рассылки
- 🗑️ Удаление аккаунта (с подтверждением)
- Управление уведомлениями

**📚 Полезные материалы**
- Материалы для изучения английского
- Рекомендуемые приложения
- Ссылки на полезные ресурсы

## 🔧 Панель управления (Менеджеры)

### Авторизация

1. Отправьте команду `/manager`
2. Введите пароль (указанный в `MANAGER_PASSWORD` в .env файле)
3. Пароль автоматически удалится из чата для безопасности
4. Сессия активна 1 час (настраивается)

### Основные функции:

**📊 Статистика**
- Общее количество пользователей
- Подписчики рассылки
- Возрастное распределение
- Статистика регистраций по дням
- Экспорт статистики

**👥 Управление пользователями**
- Просмотр списка с пагинацией (10 на страницу)
- Поиск пользователей
- Детальная информация о каждом участнике
- Фильтрация по различным критериям

**📢 Система рассылки**
- Отправка сообщений всем подписчикам
- Предварительный просмотр
- Подсчет получателей
- Отчет о доставке

**📁 Экспорт данных**
- Выгрузка всех пользователей в CSV
- Автоматическое именование файлов с датой
- Полная информация включая согласия

**⚙️ Настройки бота**
- Информация о системе
- Управление сессиями
- Статистика использования
- Очистка истекших сессий

## 🔐 Система безопасности

### Особенности авторизации:

- **Пароль из .env**: Безопасное хранение в переменных окружения
- **Сессии с таймаутом**: Автоматический выход через 1 час
- **Удаление паролей**: Сообщения с паролем удаляются автоматически
- **Контроль доступа**: Каждое действие проверяет авторизацию
- **Логирование**: Все действия менеджеров записываются в лог

### Рекомендации по безопасности:

1. **Используйте сложный пароль**: Минимум 12 символов
2. **Регулярно меняйте пароль**: Обновляйте в .env файле
3. **Не делитесь паролем**: Каждый менеджер должен знать пароль
4. **Проверяйте логи**: Отслеживайте подозрительную активность

## ⚙️ Настройка и конфигурация

### Изменение текстов диалогов:

Откройте файл `dialog_config.py` и измените нужные тексты:

```python
# Приветственное сообщение
DIALOG_TEXTS['welcome']['full_text'] = "Ваш новый текст"

# Кнопки
BUTTONS['data_consent']['yes'] = "Согласен с условиями"

# Лимиты возраста
SETTINGS['age_limits']['min'] = 16
SETTINGS['age_limits']['max'] = 65
```

### Настройка переменных окружения (.env):

```env
# Основные настройки
BOT_TOKEN=ваш_токен_бота
MANAGER_PASSWORD=безопасный_пароль_менеджера

# Настройки сессий (в секундах)
MANAGER_SESSION_TIMEOUT=3600  # 1 час

# Настройки рассылки
MAX_BROADCAST_RATE=30
BROADCAST_DELAY=1

# Логирование
LOG_LEVEL=INFO
LOG_FILE=bot.log
```

## 📊 Работа с данными

### Экспорт пользователей:

**Через бота (менеджеры):**
1. Войдите в панель управления (`/manager`)
2. Выберите "📁 Экспорт"
3. Файл будет отправлен в чат

**Через командную строку:**
```bash
python manage.py export
```

### Формат CSV файла:
- Telegram ID
- Username  
- Имя
- Возраст
- Опыт изучения английского
- Согласие на обработку данных
- Согласие на рассылку
- Дата регистрации

## 🔄 Рассылка сообщений

### Процесс отправки:

1. **Вход в панель**: `/manager` + пароль
2. **Выбор рассылки**: "📢 Рассылка"
3. **Ввод сообщения**: Напишите текст (до 4000 символов)
4. **Предварительный просмотр**: Проверьте текст и количество получателей
5. **Подтверждение**: Нажмите "📤 Отправить"
6. **Отчет**: Получите статистику доставки

### Особенности:
- Сообщения отправляются только подписчикам рассылки
- Автоматические паузы между отправками
- Отчет о неуспешных доставках
- Поддержка HTML разметки

## 🛠 Устранение проблем

### Проблемы с авторизацией:

**"Неверный пароль"**
- Проверьте файл `.env`
- Убедитесь, что нет лишних пробелов
- Пароль чувствителен к регистру

**"Сессия истекла"**
- Войдите заново через `/manager`
- Проверьте настройку `MANAGER_SESSION_TIMEOUT`

### Проблемы с базой данных:

**"База данных заблокирована"**
```bash
# Остановите бота и выполните:
python manage.py init
```

**"Пользователь не найден"**
- Пользователь должен пройти регистрацию через `/start`
- Проверьте, не была ли очищена база данных

### Проблемы с рассылкой:

**"Не удалось отправить сообщение"**
- Пользователь заблокировал бота
- Пользователь удалил аккаунт
- Проблемы с Telegram API

## 📞 Получение поддержки

При возникновении проблем:

1. **Проверьте логи**: Файл `bot.log` (если настроен)
2. **Проверьте .env файл**: Все переменные должны быть заданы
3. **Перезапустите бота**: `Ctrl+C` затем `python bot.py`
4. **Очистите сессии**: Через панель управления

## 💡 Полезные советы

### Для эффективного использования:

1. **Регулярно проверяйте статистику** для анализа активности
2. **Используйте экспорт данных** для создания отчетов
3. **Настройте автоматические рассылки** для важных объявлений
4. **Следите за размером базы данных** при большом количестве пользователей
5. **Делайте резервные копии** базы данных регулярно

### Автоматизация:

```bash
# Создание резервной копии
cp english_club.db backup_$(date +%Y%m%d).db

# Экспорт статистики
python manage.py stats > stats_$(date +%Y%m%d).txt
```